<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
    (function () {
        // 如果不在微信中, 不使用微信设置功能
        if (navigator.userAgent.indexOf('MicroMessenger') < 0) return;

        var USER = $FW.Store.getUserDict();
        var templateContent;
        var templateTitle;
        var templateUrl;
        var iurl = 'https://static.9888.cn/images/loan/invitation.jpg';

        $FW.Post( API_PATH + 'api/shareTemplate/v1/getContent.json', {
            token: USER.token,
            userGid: USER.gid,
            userId: USER.id,
            sourceType: SOURCE_TYPE,
            templateType: 1,
            //fail: () => true
        }).then(data => {
            templateContent = data.shareTemplate.templateContent;
            templateTitle = data.shareTemplate.templateTitle;
            templateUrl = data.shareTemplate.templateUrl;

            return $FW.Ajax({
                url: API_PATH + 'cashloan/outside/weixinAccountController.do?wxConfig',
                data: { url: location.href },
                //fail: () => true
            })
        }).then(data => {
            setWxConfig(data.appId, data.timestamp, data.nonceStr, data.signature);
        });

        function setWxConfig(appid, timestamp, noncestr, signature) {
            wx.config({
                debug: location.href.indexOf('debug-wechat-share') > 0,
                appId: appid,
                timestamp: timestamp,
                nonceStr: noncestr,
                signature: signature,
                jsApiList: [
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage'
                ]
            });
        }

        wx.ready(function () {
            setShareFriend()
            setShareFriendQuan()
        })

        function setShareFriend() {
            wx.onMenuShareAppMessage({
                title: templateTitle, // 分享标题
                desc: templateContent, // 分享描述
                link: templateUrl, // 分享链接
                imgUrl: iurl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        }

        function setShareFriendQuan() {
            wx.onMenuShareTimeline({
                title: templateTitle, // 分享标题
                link: templateUrl, // 分享链接
                imgUrl: iurl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        }
    })();

</script>
