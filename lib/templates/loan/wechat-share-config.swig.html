<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
    (function () {
        let USER = $FW.Store.getUserDict();
        let templateContent;
        let templateTitle;
        let templateUrl;
        let iurl = 'https://static.9888.cn/images/loan/invitation.jpg';

        $FW.Post(`${API_PATH}api/shareTemplate/v1/getContent.json`, {
            token: USER.token,
            userGid: USER.gid,
            userId: USER.id,
            sourceType: SOURCE_TYPE,
            templateType: 1
        }).then(data => {
            alert('debug getContent 2 ->' + JSON.stringify(data))
            templateContent = data.shareTemplate.templateContent;
            templateTitle = data.shareTemplate.templateTitle;
            templateUrl = data.shareTemplate.templateUrl;

            return $FW.Ajax({
                url: `${API_PATH}cashloan/outside/weixinAccountController.do?wxConfig`,
                data: {url: location.href}
            })
        }).then(data => {
            alert('debug wxConfig: ' + JSON.stringify(data))
            setWxConfig(false, data.appId, data.timestamp, data.nonceStr, data.signature);
        }).then(() => {
            setShareFriend()
            setShareFriendQuan()
        });

        function setWxConfig(debug, appid, timestamp, noncestr, signature) {
            wx.config({
                debug: true,
                appId: appid,
                timestamp: timestamp,
                nonceStr: noncestr,
                signature: signature,
                jsApiList: [
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage'
                ]
            });
        }

        function setShareFriend() {
            alert('setShareFriend: ' + templateTitle + ' , ' + templateContent + ', ' + templateUrl)
            wx.onMenuShareAppMessage({
                title: templateTitle, // 分享标题
                desc: templateContent, // 分享描述
                link: templateUrl, // 分享链接
                imgUrl: iurl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                    alert("喵喵感谢您！");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        }

        function setShareFriendQuan() {
            //alert('setShareFriendQuan')
            wx.onMenuShareTimeline({
                title: templateTitle, // 分享标题
                link: templateUrl, // 分享链接
                imgUrl: iurl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                    alert("喵喵感谢您！");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        }
    })();

</script>
