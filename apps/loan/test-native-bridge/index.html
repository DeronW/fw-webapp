{% extends '../../../lib/templates/wap_base.swig.html' %}

{% block content %}
<div id="header"></div>

<div class="buttons">
  <div>
    <label><input style="width: 300px" id="title" /> </label>
    <button onClick="setTitle()">设置标题</button>
  </div>

  <hr />

  <button onClick="trigger('hide_header')">隐藏Native头部导航</button>
  <button onClick="trigger('show_header')">显示Native头部导航</button>
  <button onClick="toNative('market')">跳转到超市页</button>
  <button onClick="toNative('fxh_detail')">跳转到放心花</button>
  <button onClick="trigger('login')">调用APP登录</button>
  <button onClick="getCookieValue('id')">获取APP Cookie id</button>
  <button onClick="getCookieValue('token')">获取APP Cookie token</button>
  <button onClick="clipboard()">复制到剪切板</button>
  <button onClick="trigger('save_fxh_qrcode')">长按保存放心花微信二维码</button>
  <button onClick="share()">调用分享</button>
  <button onClick="trigger('close')">关闭页面</button>
</div>

<div id="logs" class="logs">
  <p></p>
</div>


{% endblock %}

{% block extra_javascripts %}
<script>
    function getCookies() {
        var c = document.cookie, v = 0, cookies = {};
        if (document.cookie.match(/^\s*\$Version=(?:"1"|1);\s*(.*)/)) {
            c = RegExp.$1;
            v = 1;
        }
        if (v === 0) {
            c.split(/[,;]/).map(function(cookie) {
                var parts = cookie.split(/=/, 2),
                    name = decodeURIComponent(parts[0].trimLeft()),
                    value = parts.length > 1 ? decodeURIComponent(parts[1].trimRight()) : null;
                cookies[name] = value;
            });
        } else {
            c.match(/(?:^|\s+)([!#$%&'*+\-.0-9A-Z^`a-z|~]+)=([!#$%&'*+\-.0-9A-Z^`a-z|~]*|"(?:[\x20-\x7E\x80\xFF]|\\[\x00-\x7F])*")(?=\s*[,;]|$)/g).map(function($0, $1) {
                var name = $0,
                    value = $1.charAt(0) === '"'
                        ? $1.substr(1, -1).replace(/\\(.)/g, "$1")
                        : $1;
                cookies[name] = value;
            });
        }
        return cookies;
    }
    function getCookieValue(name) {
        return log(name+"值为", getCookies()[name])
    }

    function toNative(name){
        NativeBridge.toNative(name)
        log('跳转到app页面', name)
  }

  function clipboard(){
    NativeBridge.clipboard('复制@' + new Date())
  }

  function share(){
    NativeBridge.share({
        title: '分享标题',
        image: 'https://static.9888.cn/images/loan/invitation.jpg',
        link: 'https://www.baidu.com',
        desc: '分享描述, @' + new Date()
    })
  }

  function trigger(name) {
      NativeBridge.trigger(name)
      log('触发指令', name)
  }

  function setTitle(){
      var v = document.getElementById('title').value
    NativeBridge.setTitle(v);
    log('设置标题', v)
  }

  function log(type, cmd){
    var logs = document.getElementById('logs');
    var p = document.createElement('p');
    p.innerHTML = (new Date().toTimeString().split(' ')[0]) + ' ' + type + ' <b>' + cmd + '</b>';
    logs.insertBefore(p, logs.children[0])
  }

  window.onNativeMessageReceive = function(data){
    log('得到Native消息', JSON.stringify(data))
  }

  log('UserAgent:', navigator.userAgent);
</script>
{% endblock %}
