{% extends '../../../lib/templates/wap_base.swig.html' %}

{% block content %}
<div id="header"></div>

<div class="buttons">
  <div>
    <label><input style="width: 300px" id="title" /> </label>
    <button onClick="setTitle()">设置标题</button>
  </div>

  <hr />

  <button onClick="trigger('hide_header')">隐藏Native头部导航</button>
  <button onClick="trigger('show_header')">显示Native头部导航</button>
  <button onClick="toNative('market')">跳转到超市页</button>
  <button onClick="toNative('fxh_detail')">跳转到放心花</button>
  <button onClick="trigger('login')">调用APP登录</button>
  <button onClick="getCookieValue('uid')">获取APP Cookie uid</button>
  <button onClick="getCookieValue('token')">获取APP Cookie token</button>
  <button onClick="clipboard()">复制到剪切板</button>
  <button onClick="trigger('save_fxh_qrcode')">长按保存放心花微信二维码</button>
  <button onClick="share()">调用分享</button>
  <button onClick="trigger('close')">关闭页面</button>
</div>

<div id="logs" class="logs">
  <p></p>
</div>


{% endblock %}

{% block extra_javascripts %}
<script>
    function getCookie(){
        var cookie = {};
        var all = document.cookie;
        if( all === "" ){
            return cookie;
        }
        var list = all.split( "; " );
        for( var i=0; i<list.length; i++ ){
            var singleCookie = list[i];
            var p = singleCookie.indexOf( "=" );
            var name = singleCookie.substring( 0, p );
            var value = singleCookie.substring( p+1 );
            value = decodeURIComponent( value );
            cookie[name] = value
        }
        return cookie;
    }
    function getCookieValue(name) {
        return log(name+"值为", getCookie()[name])
    }


    function toNative(name){
        NativeBridge.toNative(name)
        log('跳转到app页面', name)
  }

  function clipboard(){
    NativeBridge.clipboard('复制@' + new Date())
  }

  function share(){
    NativeBridge.share({
        title: '分享标题',
        image: 'https://static.9888.cn/images/loan/invitation.jpg',
        link: 'https://www.baidu.com',
        desc: '分享描述, @' + new Date()
    })
  }

  function trigger(name) {
      NativeBridge.trigger(name)
      log('触发指令', name)
  }

  function setTitle(){
      var v = document.getElementById('title').value
    NativeBridge.setTitle(v);
    log('设置标题', v)
  }

  function log(type, cmd){
    var logs = document.getElementById('logs');
    var p = document.createElement('p');
    p.innerHTML = (new Date().toTimeString().split(' ')[0]) + ' ' + type + ' <b>' + cmd + '</b>';
    logs.insertBefore(p, logs.children[0])
  }

  window.onNativeMessageReceive = function(data){
    log('得到Native消息', JSON.stringify(data))
  }

  log('UserAgent:', navigator.userAgent);
</script>
{% endblock %}
